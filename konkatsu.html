<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>å©šæ´»ãŠåŠ©ã‘ãƒ¡ãƒ¢</title>
    <script src="js/jquery-2.1.3.min.js"></script>
    <link rel="stylesheet" href="css/sample.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+Antique&display=swap"
      rel="stylesheet"
    />
  </head>
  <body style="font-family: 'Zen Kaku Gothic Antique', sans-serif">
    <header>
      <h1>å©šæ´»ãŠåŠ©ã‘ãƒ¡ãƒ¢</h1>
      <h2>
        å©šæ´»ã§å‡ºä¼šã£ãŸãƒ¡ãƒ³ã‚ºãŸã¡ã‚’<br />
        è¨˜éŒ²ãƒ»æ¯”è¼ƒæ¤œè¨ãƒ»ãŠè¦‹åˆ‡ã‚Šã§ãã‚‹ã‚¢ãƒ—ãƒªã§ã™ã€‚
      </h2>
    </header>

    <main>
      <label for="key">åå‰</label><br />
      <input type="text" id="key" name="key"><br />
      <label for="old">å¹´é½¢</label>
      <select id="old" name="old"></select><br />
      <label for="money">å¹´å</label>
      <select id="money" name="money"></select><br />
      <label for="tall">èº«é•·</label>
      <select id="tall" name="tall"></select><br />
      <label for="cost">ãƒ‡ãƒ¼ãƒˆè²»ç”¨</label>
      <select id="cost" name="cost"></select><br />
      <label for="memo">ğŸ”½ãŠç›¸æ‰‹ã®ç‰¹å¾´ã‚„æ°—ã¥ã„ãŸã“ã¨ğŸ”½</label><br />
      <textarea id="memo" name="memoContent"></textarea><br />
      <ul>
        <li id="save">æ–°ã—ã„ãƒ¡ãƒ³ã‚ºã‚’ç™»éŒ²ï¼</li>
        <li id="clear">ãŠè¦‹åˆ‡ã‚Šã™ã‚‹ï¼</li>
      </ul>
    
      <table id="shinkou">
        <thead>
          <tr>
            <h2>é€²è¡Œä¸­ã®ãƒ¡ãƒ³ã‚ºãŸã¡</h2>
            <th>é¸æŠ</th><!-- ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ç”¨ã®åˆ—ã‚’è¿½åŠ  -->  
            <th>åå‰</th>
            <th>å¹´é½¢</th>
            <th>å¹´å</th>
            <th>èº«é•·</th>
            <th>ãƒ‡ãƒ¼ãƒˆè²»ç”¨</th>
            <th>ãƒ¡ãƒ¢</th>
          </tr>
        </thead>
        
        <tbody>
          <!-- ãƒ‡ãƒ¼ã‚¿è¡Œã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
        </tbody>
      </table>

      <table id="omikiri">
        <thead>
          <tr>
            <h2>ãŠè¦‹åˆ‡ã‚Šãƒ¡ãƒ³ã‚ºä¸€è¦§</h2>
            <!-- <th>é¸æŠ</th> -->
            <th>å†ç™»éŒ²</th>
            <th>åå‰</th>
            <th>å¹´é½¢</th>
            <th>å¹´å</th>
            <th>èº«é•·</th>
            <th>ãƒ‡ãƒ¼ãƒˆè²»ç”¨</th>
            <th>ãƒ¡ãƒ¢</th>
          </tr>
        </thead>
        <tbody>
          <!-- å‰Šé™¤ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®è¡ŒãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
        </tbody>
      </table>
    </main>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
      import {
  getDatabase,
        ref,
        push,
        set,
        onChildAdded,onChildRemoved,onChildChanged,remove
      } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";
      import {
        getStorage,
        ref as sRef,
        uploadBytes,
        getDownloadURL,
      } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-storage.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCoYOpXc12mqblZgK_tSt8U1l32tAF__6E",
        authDomain: "konkatsufire-43075.firebaseapp.com",
        projectId: "konkatsufire-43075",
        storageBucket: "konkatsufire-43075.appspot.com",
        messagingSenderId: "725195122041",
        appId: "1:725195122041:web:2953ca33b8b4ba30c0fba8",
      };

      // Firebaseã‚¢ãƒ—ãƒªã®åˆæœŸåŒ–
      const app = initializeApp(firebaseConfig);
        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å‚ç…§ã‚’å–å¾—
      const db = getDatabase(app);
    

      // å¹´é½¢ã®é¸æŠè‚¢ã‚’è¨­å®š
      for (let i = 18; i <= 99; i++) {
        $('#old').append($('<option>', {
          value: i,
          text: i + 'æ­³'
        }));
      }

      // å¹´åã®é¸æŠè‚¢ã‚’è¨­å®š
      const incomes = ['200ä¸‡å††æœªæº€', '200ã€œ400ä¸‡å††', '400ã€œ600ä¸‡å††', '600ã€œ800ä¸‡å††', '800ã€œ1000ä¸‡å††', '1000ã€œ1500ä¸‡å††', '1500ã€œ2000ä¸‡å††', '2000ã€œ2500ä¸‡å††', '2500ã€œ3000ä¸‡å††', '3000ä¸‡å††ä»¥ä¸Š'];
      incomes.forEach(income => {
        $('#money').append($('<option>', {
          value: income,
          text: income
        }));
      });

      // èº«é•·ã®é¸æŠè‚¢ã‚’è¨­å®š
      for (let i = 150; i <= 200; i++) {
        $('#tall').append($('<option>', {
          value: i,
          text: i + 'cm'
        }));
      }

      // ãƒ‡ãƒ¼ãƒˆè²»ç”¨ã®é¸æŠè‚¢ã‚’è¨­å®š
      const costs = ['ç”·æ€§ã®ãŠã”ã‚Š', 'ç”·æ€§ãŒå¤šã‚ã«æ‰•ã£ãŸ', 'å‰²ã‚Šå‹˜', 'ç§ãŒå¤šã‚ã«æ‰•ã£ãŸ', 'ç§ã®ãŠã”ã‚Š'];
      costs.forEach(cost => {
        $('#cost').append($('<option>', {
          value: cost,
          text: cost
        }));
      });

      $("#save").on("click",function(){
      const key = $("#key").val();
      const old = $("#old").val()+"æ­³";
      const money = $("#money").val();
      const tall = $("#tall").val()+"cm";
      const cost = $("#cost").val();
      const memoContent =$("#memo").val();
      const newRow = "<tr><td><input type='checkbox'></td><td>" + key + "</td><td>" + old + "</td><td>" + money + "</td><td>" + tall + "</td><td>" + cost + "</td><td>" + memoContent + "</td></tr>";
      $("#shinkou tbody").append(newRow);

       // Firebaseã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
      const newPostRef = push(ref(db, 'mens')); // 'mens'ã¯ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ãƒãƒ¼ãƒ‰å
      set(newPostRef, {
      name: key,
      memo: memoContent
      });
      });

      
      $("#clear").on("click",function(){
        const checkbox = $("#shinkou tbody input:checked");
        alert("æœ¬å½“ã«ãŠè¦‹åˆ‡ã‚Šã—ã¾ã™ã‹ï¼Ÿ");
        checkbox.each(function(){
        const row = $(this).closest("tr");
        const name = row.find("td:nth-child(2)").text();
        const old  = row.find("td:nth-child(3)").text();
        const money = row.find("td:nth-child(4)").text();
        const tall = row.find("td:nth-child(5)").text();
        const cost = row.find("td:nth-child(6)").text();
        const memo = row.find("td:nth-child(7)").text();

        const omikiriRow = "<tr><td><button class='re-register'>å†ç™»éŒ²</button></td><td>"+ name + "</td><td>" + old + "</td><td>" + money + "</td><td>" + tall + "</td><td>" + cost + "</td><td>" + memo + "</td></tr>";
        $("#omikiri tbody").append(omikiriRow);

        const dataId = row.attr("id");
        const dataRef = ref(db, "mens/" + dataId);

        remove(dataRef)
        .then(() => {
          row.remove();
          alert("ãŠè¦‹åˆ‡ã‚Šã—ã¾ã—ãŸï¼æ¬¡ã®ãƒ¡ãƒ³ã‚ºã«è¡Œãã¾ã—ã‚‡ã†ï¼");
        });
      });
      });

      // ãŠè¦‹åˆ‡ã‚Šãƒ¡ãƒ³ã‚ºä¸€è¦§ã‹ã‚‰å†ç™»éŒ²ã™ã‚‹æ©Ÿèƒ½
      $("#omikiri").on("click", ".re-register", function() {
        const row = $(this).closest("tr");
        const name = row.find("td:nth-child(2)").text();
        const old = row.find("td:nth-child(3)").text();
        const money = row.find("td:nth-child(4)").text();
        const tall = row.find("td:nth-child(5)").text();
        const cost = row.find("td:nth-child(6)").text();
        const memo = row.find("td:nth-child(7)").text();
     
        // é€²è¡Œä¸­ã®ãƒ¡ãƒ³ã‚ºãŸã¡ã«è¡Œã‚’è¿½åŠ 
        const newRow = "<tr><td><input type='checkbox'></td><td>" + name + "</td><td>" + old + "</td><td>" + money + "</td><td>" + tall + "</td><td>" + cost + "</td><td>" + memo + "</td></tr>";
        $("#shinkou tbody").append(newRow);
        alert("å¾©æ´»ã•ã›ã¾ã™ã‹ï¼Ÿ");

        // Firebaseã«ãƒ‡ãƒ¼ã‚¿ã‚’å†ç™»éŒ²
        const newPostRef = push(ref(db, 'mens'));
        set(newPostRef, {
          name: name,
          age: old,
          income: money,
          height: tall,
          dateCost: cost,
          memo: memo
        });

        // ãŠè¦‹åˆ‡ã‚Šãƒ¡ãƒ³ã‚ºä¸€è¦§ã‹ã‚‰è¡Œã‚’å‰Šé™¤
        row.remove();
        alert("å†ã‚¢ã‚¿ãƒƒã‚¯ã—ã¾ã—ã‚‡ã†ï¼");
      });

  </script>
  </body>
</html>
